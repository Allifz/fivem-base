-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
vSERVER = Tunnel.getInterface("crafting")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local Timer = 0
local Select = ""
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING
-----------------------------------------------------------------------------------------------------------------------------------------
local Crafting = {
	["1"] = { vec3(85.68,-1550.42,29.6),"Lixeiro" },
	["2"] = { vec3(287.36,2843.6,44.7),"Lixeiro" },
	["3"] = { vec3(-413.68,6171.99,31.48),"Lixeiro" },
	["4"] = { vec3(577.92,-1448.69,20.76),"Ilegal" },
	["5"] = { vec3(46.21,-1749.45,29.64),"Mercado" },
	["6"] = { vec3(2747.81,3472.91,55.67),"Mercado" },
	["7"] = { vec3(807.67,-757.51,26.77),"PizzaThis" },
	["8"] = { vec3(-1198.04,-899.07,13.99),"BurgerShot" },
	["9"] = { vec3(-590.37,-1059.77,22.34),"UwuCoffee" },
	["10"] = { vec3(122.69,-1041.57,29.56),"BeanMachine" },
	["11"] = { vec3(95.58,-1985.56,20.44),"Ballas" },
	["12"] = { vec3(-31.47,-1434.84,31.49),"Families" },
	["13"] = { vec3(429.41,-2051.93,18.74),"Vagos" },
	["14"] = { vec3(512.29,-1803.52,28.51),"Aztecas" },
	["15"] = { vec3(228.28,-1752.89,25.24),"Bloods" },
	["16"] = { vec3(1256.18,-1567.55,58.35),"Marabunta" },
	["17"] = { vec3(1402.34,1139.87,109.74),"Mafia" },
	["18"] = { vec3(1382.29,-179.32,161.24),"Grota" },
	["19"] = { vec3(2248.78,50.39,251.42),"SV" },
	["20"] = { vec3(1707.74,387.17,245.65),"Ruinxos" },
	["21"] = { vec3(-309.05,1521.08,367.75),"Pedreira" },
	["22"] = { vec3(472.32,-1308.93,29.23),"Credential" }

	}
-----------------------------------------------------------------------------------------------------------------------------------------
-- THREADSTART
-----------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
    local Table = {}

    for _,v in pairs(Crafting) do
        table.insert(Table,{ v[1]["x"],v[1]["y"],v[1]["z"],1.25,"E","Crafting","Pressione para abrir" })
    end

    TriggerEvent("hoverfy:Insert",Table)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- THREADOPEN
-----------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
	while true do
		local TimeDistance = 999
		if LocalPlayer["state"]["Route"] < 900000 then
			local Ped = PlayerPedId()

			if not IsPedInAnyVehicle(Ped) then
				local Coords = GetEntityCoords(Ped)

				for _,v in pairs(Crafting) do
					local Distance = #(Coords - v[1])
					if Distance <= 1.25 then
						TimeDistance = 1
						
						if IsControlJustPressed(1,38) and vSERVER.Permission(v[2]) then
							if v[2] ~= Select and GetGameTimer() < Timer then
								TriggerEvent("Notify","amarelo","Produção em andamento.",5000)
							else
								Select = v[2]
								SetNuiFocus(true,true)
								SendNUIMessage({ action = "OpenCraft", data = vSERVER.Request(Select) })
							end
						end
					end
				end
			end
		end
		
		Wait(TimeDistance)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Close",function(Data,Callback)
	SetNuiFocus(false,false)

	Callback("Ok")
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- OWNED
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Owned",function(Data,Callback)
	Callback(vSERVER.Owned(Data["id"],Data["key"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Crafting",function(Data,Callback)
	if GetGameTimer() >= Timer then
		Timer = GetGameTimer() + Data["time"] * 1000

		SetTimeout(Data["time"] * 1000,function()
			vSERVER.Crafting(Data["id"],Data["key"],Data["amount"])
		end)

		Callback(true)
	else
		TriggerEvent("Notify","amarelo","Produção em andamento.",5000)
		Callback(false)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING:INVENTORY
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("crafting:Inventory")
AddEventHandler("crafting:Inventory",function()
	if "Inventory" ~= Select and GetGameTimer() < Timer then
		TriggerEvent("Notify","amarelo","Produção em andamento.",5000)
		return
	end

	Select = "Inventory"
	SetNuiFocus(true,true)
	SendNUIMessage({ action = "OpenCraft", data = vSERVER.Request("Inventory") })
end)